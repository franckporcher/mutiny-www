# 
# HOST.mutiny-staging-php-app-1 - Custom parameters
#
#
# PROJECT: MUTINY Tahiti's websites
#
# Copyright (C) 1995-2015 - Franck Porcher, Ph.D 
# www.franckys.com
# Tous droits réservés
# All rights reserved

#------------------------------------
# APPLICATION 
#------------------------------------
WWW_INSTALLDIR=/srv/www/mutiny/current

#------------------------------------
# Web Server
#------------------------------------
WWW_CONF=/etc/apache2
APACHE_RUN_USER="$(getconf "${WWW_CONF}/envvars" 'APACHE_RUN_USER=(\w+)')"
APACHE_RUN_GROUP="$(getconf "${WWW_CONF}/envvars" 'APACHE_RUN_GROUP=(\w+)')"
APACHE_LOG_DIR="$(getconf "${WWW_CONF}/envvars" 'APACHE_LOG_DIR=(\w+)')"
VHOST_SERVER_NAME='mutinytahiti.com'
VHOST_SERVER_ALIAS="www.mutinytahiti.com mutiny-tahiti.com www.mutiny-tahiti.com"
VHOST_SERVER_ADMIN='webmaster@mutinytahiti.com'
VHOST_DOCUMENT_ROOT="${WWW_INSTALLDIR}"
VHOST_ERRORLOG="${APACHE_LOG_DIR}/mutinytahiti.com.error.log"
VHOST_CUSTOMLOG_1="${APACHE_LOG_DIR}/mutinytahiti.com.access.log"
VHOST_CUSTOMLOG_MODE_1=combined
VHOST_CUSTOMLOG_2="${APACHE_LOG_DIR}/mutinytahiti.com.ganglia.log"
VHOST_CUSTOMLOG_MODE_2=ganglia
VHOST_INCLUDE_OPTIONAL_1="${WWW_CONF}/sites-available/mutiny.conf.d/rewrite*"
VHOST_INCLUDE_OPTIONAL_2="${WWW_CONF}/sites-available/mutiny.conf.d/local*"

#------------------------------------
# DATA STORE 
#------------------------------------
DEFAULT_DB_SERVER='mutiny-staging-rds.cfwvxsax91fg.us-east-1.rds.amazonaws.com'
eval "DBSERVER=$(grep -m 1 -E 'SetEnv.+DBSERVER' "${WWW_CONF}/sites-enabled/mutiny.conf" | awk '{print $3}')"
[ -z "${DBSERVER}" ] && DBSERVER="${DEFAULT_DB_SERVER}"

DEFAULT_DB_PORT=3306
eval "DBPORT=$(grep -m 1 -E 'SetEnv.+DBPORT' "${WWW_CONF}/sites-enabled/mutiny.conf" | awk '{print $3}')"
[ -z "${DBPORT}" ] && DBPORT="${DEFAULT_DB_PORT}"

#------------------------------------
# CONFIG FILES
#------------------------------------
unset CONFIG
declare -A CONFIG

# CONFIG[ module-name         ]    => "module-conffile-tag... "
# CONFIG[ module-conffile-tag ]    => "<OP> TEMPLATE_FILE INSTALLDIR"
#
#   OP={install,append,tmpl.install,sed.install,tmpl.append,sed.append}

## OPERATIONAL ##
CONFIG[mutiny]="mutiny-apache2-conf mutiny-apache2-envvars mutiny-apache2-charset mutiny-apache2-mutiny-conf"
CONFIG[store]="store-presta-settings"
CONFIG[wordpress]="wordpress-config"

       CONFIG[mutiny-apache2-conf]="append       apache2.conf                  ${WWW_CONF}/apache2.conf"
    CONFIG[mutiny-apache2-envvars]="append       apache2.envvars               ${WWW_CONF}/envvars"
    CONFIG[mutiny-apache2-charset]="append       apache2.charset.conf          ${WWW_CONF}/conf-available/charset.conf"
CONFIG[mutiny-apache2-mutiny-conf]="tmpl.install apache2.mutiny.conf.tmpl      ${WWW_CONF}/sites-available/mutiny.conf"
     CONFIG[store-presta-settings]="sed.install  prestashop.settings.php.tmpl  ${WWW_INSTALLDIR}/store/config/settings.inc.php"
          CONFIG[wordpress-config]="sed.install  wordpress.config.php.tmpl     ${WWW_INSTALLDIR}/wordpress/wp-config.php"
